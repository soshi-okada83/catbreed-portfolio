# 改修・追加実装ログ（Improvements）

このドキュメントでは、アプリ完成後に行った改善・追加機能の実装内容をまとめる。

---

## 🐾 1. 推論結果の日本語表記対応（Issue #1）

### 🔧 実施内容
- **`breed_mapping_ja.json` を作成し、英語 → 日本語の猫種名変換を実装**
- **FastAPI の `predict.py` 内で、返却直前にクラス名を日本語へ変換**
- **フロントの結果表示（Upload.tsx）を日本語表記に統一**
- **Page.tsx に残っていた重複表示を削除し、UI を一本化**

### 🎯 目的
- **推論結果とGPT説明文の表記を日本語に統一し、読みやすさ向上**
- **ポートフォリオとしての完成度を高める**

### ✅ 動作確認
- **12猫種すべてで日本語表記が適切に反映されることを確認**
- **CLASSES とマッピングキーのずれによる不一致も修正済み**

## 🧩 確認スクリーンショット

![Issue #1 完成画像](../img/fix1.jpg)

---

## 🐾 2. 推定された猫種に質問できる AIチャット機能 の実装（Issue #2）

### ✏ 実施内容
- **breed_chat.py を新規追加し、OpenAI Chat API を利用したチャット機能を実装**
- **.env の読み込みを明示的に行い、OPENAI_API_KEY の有無で挙動を切り替え**
- **FastAPI (app/main.py) に /breed_chat ルーターを追加**
- **fetchBreedChat.ts を新規作成し、チャットAPIと通信する関数を追加**
- **BreedChat.tsx を新規作成し、チャットUIを実装**
- **Upload.tsx にチャット欄を統合し、推論結果 → 説明文 → チャット という流れを構築**

## 🎯 目的
- **猫種に関してユーザーが自由に質問できるようにし、対話型アプリケーションへ進化させるため**
- **GPT API を用いたインタラクティブ機能として、ポートフォリオのアピールポイントを強化するため**
- **静的説明文だけでは伝えきれない「飼いやすさ」「性格」「注意点」など、個別質問に応じた情報提供を可能にするため**

## ✅ 動作確認
- **推論 → 説明文生成 → AIチャットの一連の流れが正常に動作することを確認**
- **日本語による質問に対し、自然な日本語回答が返ってくることを確認**
- **APIキー未設定時はチャット機能のみ 500 エラーを返し、アプリ全体は問題なく動作する仕様を確認**
- **メッセージ履歴がバブル形式で正しく表示されることを確認**

## 🧩 確認スクリーンショット

![Issue #2 完成画像](../img/update1.jpg)

---

## 🐾 3. AIチャット機能へのストリーミング対応（Issue #3）

### ✏ 実施内容
- **OpenAI Chat API を stream=True で実行し、トークン単位で応答を受け取る方式に変更**
- **breed_chat.py 内に /breed_chat/stream エンドポイントを新規追加**
- **FastAPI でリアルタイム配信を実装**
- **app/main.py にストリーミング版のルーターを追加**
- **フロント側にストリーム受信用の関数を実装**
- **チャットUIをリアルタイム更新に対応させ、トークンが届くたびにバブルを更新**
- **非ストリーミング版は後方互換のため残置**

## 🎯 目的

- **ChatGPTのようなリアルタイム応答を実現し、体感速度を大幅に向上させるため**
- **長文回答でも途中から読み始められる、自然なチャット体験を提供するため**
- **流れるような応答体験を実装し、ポートフォリオとしての技術的価値を強化するため**
- **SSE（Server-Sent Events）や Streaming API の利用経験を示せるようにするため**

✅ 動作確認
- **推論 → 説明文生成 → ストリーミングチャットまで一連の動作がスムーズに行われることを確認**
- **日本語質問に対して、1〜3トークン単位で継続的にメッセージが届くことを確認**
- **生成完了時に [DONE] を受け取り、チャットバブルが確定することを確認**
- **途中でページ遷移やタブ変更をしてもエラー落ちしないことを確認**
- **非ストリーミング版エンドポイントとの共存を確認**

---

### 🐾 4. 説明文生成中に進捗ゲージを追加（Issue #4）

## ✏ 実施内容
- **ProgressBar.tsx を新規作成し、0％ → 80％ まで自動進行する疑似プログレスバーを実装**
- **説明文生成中（descLoading === true）の間のみバーを表示**
- **OpenAIからレスポンスが返ってきた瞬間に進捗を 100％ に強制更新し、その後フェードアウト**
- **Upload.tsx にバーを統合し、「説明文生成中…」の下に自然な位置で表示**
- **バーの進み方・消えるタイミングを自然に見えるよう調整**

## 🎯 目的
- **説明文生成に数秒かかるため、ユーザーに“動いている安心感”を提供するため**
- **固まったように見える問題を解消し、UX を大幅に改善するため**
- **ローディングUI（プログレスバー）の実装スキルを示すため**
- **生成完了が自然に分かるアニメーションによって体験価値を高めるため**

## ✅ 動作確認
- **説明文生成開始時にバーが 0〜80% の間を滑らかに進行することを確認**
- **生成完了時にバーが 100% になり、自動でフェードアウトする動作を確認**
- **API が高速に返ってきた場合でも、バー表示 → フェードアウトが自然に見えることを確認**

## 🧩 確認スクリーンショット

![Issue #4 完成画像](../img/update2.jpg)

---